<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MIDI Line - Conversión de guitarra a MIDI</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app">
      <header>
        <h1>MIDI Line</h1>
        <p>
          Conversión en tiempo real de guitarra eléctrica a MIDI desde la línea de entrada.
          Ajusta los parámetros para obtener una detección precisa y sin artefactos.
        </p>
      </header>

      <section class="status">
        <div class="status-card">
          <h2>Estado</h2>
          <p id="status">Detenido</p>
          <div class="status-grid">
            <div>
              <span>Nota detectada</span>
              <strong id="note">--</strong>
            </div>
            <div>
              <span>Frecuencia</span>
              <strong id="frequency">-- Hz</strong>
            </div>
            <div>
              <span>Velocidad</span>
              <strong id="velocity-display">--</strong>
            </div>
            <div>
              <span>Claridad</span>
              <strong id="clarity">--</strong>
            </div>
          </div>
        </div>
        <div class="status-card">
          <h2>Salida MIDI</h2>
          <label for="midi-output">Dispositivo</label>
          <select id="midi-output">
            <option value="">Sin dispositivo</option>
          </select>
          <p class="hint">Si no hay dispositivos MIDI, el sistema mostrará los eventos en el registro.</p>
        </div>
      </section>

      <section class="controls">
        <div class="controls-header">
          <h2>Controles de conversión</h2>
          <div class="controls-actions">
            <label class="preset-select">
              Preset rápido
              <select id="preset"></select>
            </label>
            <div class="button-row">
              <button id="start">Iniciar</button>
              <button id="stop" disabled>Detener</button>
            </div>
          </div>
        </div>

        <div class="control-grid">
          <label>
            Ganancia de entrada (dB)
            <input id="input-gain" type="range" min="-12" max="24" step="1" value="12" />
            <span id="input-gain-value">12 dB</span>
          </label>
          <label>
            Filtro pasa altos (Hz)
            <input id="highpass" type="range" min="20" max="200" step="5" value="70" />
            <span id="highpass-value">70 Hz</span>
          </label>
          <label>
            Filtro pasa bajos (Hz)
            <input id="lowpass" type="range" min="800" max="8000" step="100" value="3500" />
            <span id="lowpass-value">3500 Hz</span>
          </label>
          <label>
            Puerta de ruido (dB)
            <input id="noise-gate" type="range" min="-90" max="-20" value="-90" />
            <span id="noise-gate-value">-90 dB</span>
          </label>
          <label>
            Suavizado de tono
            <input id="smoothing" type="range" min="0" max="0.95" step="0.05" value="0" />
            <span id="smoothing-value">0</span>
          </label>
          <label>
            Estabilidad mínima (frames)
            <input id="stability" type="range" min="2" max="20" value="4" />
            <span id="stability-value">4</span>
          </label>
          <label>
            Duración mínima nota (ms)
            <input id="min-duration" type="range" min="40" max="400" step="10" value="40" />
            <span id="min-duration-value">40 ms</span>
          </label>
          <label>
            Rango de pitch bend (semitonos)
            <input id="bend-range" type="range" min="1" max="12" value="2" />
            <span id="bend-range-value">2</span>
          </label>
          <label class="toggle">
            <span>Pitch bend (gliss)</span>
            <div class="toggle-row">
              <input id="pitch-bend-enabled" type="checkbox" />
              <small>Desactivado para evitar gliss y temperar notas.</small>
            </div>
          </label>
          <label>
            Umbral de cambio de nota (cents)
            <input id="note-hysteresis" type="range" min="10" max="80" value="50" />
            <span id="note-hysteresis-value">50</span>
          </label>
          <label>
            Frecuencia mínima (Hz)
            <input id="min-frequency" type="range" min="50" max="200" step="5" value="70" />
            <span id="min-frequency-value">70 Hz</span>
          </label>
          <label>
            Frecuencia máxima (Hz)
            <input id="max-frequency" type="range" min="500" max="2000" step="25" value="1200" />
            <span id="max-frequency-value">1200 Hz</span>
          </label>
          <label>
            Umbral de claridad
            <input id="clarity-threshold" type="range" min="0.5" max="0.98" step="0.01" value="0.5" />
            <span id="clarity-threshold-value">0.5</span>
          </label>
          <label>
            Delta de ataque (dB)
            <input id="attack-threshold" type="range" min="2" max="12" step="1" value="2" />
            <span id="attack-threshold-value">2 dB</span>
          </label>
          <label>
            Sensibilidad de velocidad
            <input id="velocity" type="range" min="0.2" max="1" step="0.05" value="1" />
            <span id="velocity-value">1</span>
          </label>
          <label>
            Intervalo de análisis (ms)
            <input id="analysis-interval" type="range" min="10" max="100" step="5" value="10" />
            <span id="analysis-interval-value">10 ms</span>
          </label>
          <label class="toggle">
            <span>Monitor interno</span>
            <div class="toggle-row">
              <input id="monitor-enabled" type="checkbox" />
              <small>Escucha el MIDI sin dispositivo externo</small>
            </div>
          </label>
          <label>
            Volumen del monitor
            <input id="monitor-volume" type="range" min="0" max="1" step="0.05" value="0.4" />
            <span id="monitor-volume-value">0.4</span>
          </label>
        </div>
      </section>

      <section class="log">
        <h2>Registro</h2>
        <textarea id="log" readonly></textarea>
      </section>

      <section class="tips">
        <h2>Consejos para mejorar precisión</h2>
        <ul>
          <li>Usa la entrada de línea directa de la tarjeta de sonido con nivel adecuado.</li>
          <li>Reduce efectos (reverb/distorsión) para evitar armónicos falsos.</li>
          <li>Ajusta la puerta de ruido para eliminar zumbidos y ruido de fondo.</li>
          <li>Aumenta la estabilidad mínima si aparecen notas fantasma.</li>
          <li>El modo temperado evita gliss: activa pitch bend solo si lo necesitas.</li>
          <li>Configura el rango de pitch bend acorde a tu plugin o sintetizador.</li>
          <li>Si no tienes un dispositivo MIDI, activa el monitor interno para escuchar la salida.</li>
        </ul>
      </section>
    </main>

    <script src="app.js"></script>
  </body>
</html>
